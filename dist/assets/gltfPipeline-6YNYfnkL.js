import{n as Ce,o as Fe,p as Ue,q as Me,j as ye,i as Oe,h as X,W as ze,r as Be,C as De,s as Pe,V as k,t as J,u as Ge,N as ke,b as ie,v as He,e as Ee,l as F,w as $,I as Ve,x as Ie,y as Ye,z as Ke,A as je,J as We,K as Xe,X as $e,Y as qe,Z as Je,_ as Ze,$ as Qe,Q as et,B as tt,m as st,O as nt,f as it,G as fe,F as rt,g as ot,U as he}from"./USDZLoader-B-5PUlvD.js";let H,Z,P,j;function Q(a,e=1/0,s=null){Z||(Z=new Ce(2,2,1,1)),P||(P=new Fe({uniforms:{blitTexture:new Ue(a)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),P.uniforms.blitTexture.value=a,P.defines.IS_SRGB=a.colorSpace==Me,P.needsUpdate=!0,j||(j=new ye(Z,P),j.frustumCulled=!1);const t=new Oe,i=new X;i.add(j),s===null&&(s=H=new ze({antialias:!1}));const r=Math.min(a.image.width,e),n=Math.min(a.image.height,e);s.setSize(r,n),s.clear(),s.render(i,t);const o=document.createElement("canvas"),c=o.getContext("2d");o.width=r,o.height=n,c.drawImage(s.domElement,0,0,r,n);const l=new Be(o);return l.minFilter=a.minFilter,l.magFilter=a.magFilter,l.wrapS=a.wrapS,l.wrapT=a.wrapT,l.name=a.name,H&&(H.forceContextLoss(),H.dispose(),H=null),l}const de={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class oe{constructor(){this.pluginCallbacks=[],this.register(function(e){return new xt(e)}),this.register(function(e){return new mt(e)}),this.register(function(e){return new yt(e)}),this.register(function(e){return new Et(e)}),this.register(function(e){return new It(e)}),this.register(function(e){return new At(e)}),this.register(function(e){return new Tt(e)}),this.register(function(e){return new wt(e)}),this.register(function(e){return new Mt(e)}),this.register(function(e){return new bt(e)}),this.register(function(e){return new Rt(e)}),this.register(function(e){return new Lt(e)}),this.register(function(e){return new St(e)}),this.register(function(e){return new Nt(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,s,t,i){const r=new gt,n=[];for(let o=0,c=this.pluginCallbacks.length;o<c;o++)n.push(this.pluginCallbacks[o](r));r.setPlugins(n),r.write(e,s,i).catch(t)}parseAsync(e,s){const t=this;return new Promise(function(i,r){t.parse(e,i,r,s)})}}const T={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ee="KHR_mesh_quantization",N={};N[Ke]=T.NEAREST;N[je]=T.NEAREST_MIPMAP_NEAREST;N[We]=T.NEAREST_MIPMAP_LINEAR;N[Xe]=T.LINEAR;N[$e]=T.LINEAR_MIPMAP_NEAREST;N[qe]=T.LINEAR_MIPMAP_LINEAR;N[Je]=T.CLAMP_TO_EDGE;N[Ze]=T.REPEAT;N[Qe]=T.MIRRORED_REPEAT;const pe={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},at=new De,ge=12,ct=1179937895,lt=2,xe=8,ut=1313821514,ft=5130562;function V(a,e){return a.length===e.length&&a.every(function(s,t){return s===e[t]})}function ht(a){return new TextEncoder().encode(a).buffer}function dt(a){return V(a.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function pt(a,e,s){const t={min:new Array(a.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(a.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=e;i<e+s;i++)for(let r=0;r<a.itemSize;r++){let n;a.itemSize>4?n=a.array[i*a.itemSize+r]:(r===0?n=a.getX(i):r===1?n=a.getY(i):r===2?n=a.getZ(i):r===3&&(n=a.getW(i)),a.normalized===!0&&(n=ie.normalize(n,a.array))),t.min[r]=Math.min(t.min[r],n),t.max[r]=Math.max(t.max[r],n)}return t}function Ae(a){return Math.ceil(a/4)*4}function te(a,e=0){const s=Ae(a.byteLength);if(s!==a.byteLength){const t=new Uint8Array(s);if(t.set(new Uint8Array(a)),e!==0)for(let i=a.byteLength;i<s;i++)t[i]=e;return t.buffer}return a}function me(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function Te(a,e){if(a.toBlob!==void 0)return new Promise(t=>a.toBlob(t,e));let s;return e==="image/jpeg"?s=.92:e==="image/webp"&&(s=.8),a.convertToBlob({type:e,quality:s})}class gt{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+Pe}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,s,t={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},t),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,r=i.buffers,n=i.json;t=i.options;const o=i.extensionsUsed,c=i.extensionsRequired,l=new Blob(r,{type:"application/octet-stream"}),d=Object.keys(o),u=Object.keys(c);if(d.length>0&&(n.extensionsUsed=d),u.length>0&&(n.extensionsRequired=u),n.buffers&&n.buffers.length>0&&(n.buffers[0].byteLength=l.size),t.binary===!0){const x=new FileReader;x.readAsArrayBuffer(l),x.onloadend=function(){const f=te(x.result),p=new DataView(new ArrayBuffer(xe));p.setUint32(0,f.byteLength,!0),p.setUint32(4,ft,!0);const h=te(ht(JSON.stringify(n)),32),g=new DataView(new ArrayBuffer(xe));g.setUint32(0,h.byteLength,!0),g.setUint32(4,ut,!0);const b=new ArrayBuffer(ge),S=new DataView(b);S.setUint32(0,ct,!0),S.setUint32(4,lt,!0);const D=ge+g.byteLength+h.byteLength+p.byteLength+f.byteLength;S.setUint32(8,D,!0);const m=new Blob([b,g,h,p,f],{type:"application/octet-stream"}),y=new FileReader;y.readAsArrayBuffer(m),y.onloadend=function(){s(y.result)}}}else if(n.buffers&&n.buffers.length>0){const x=new FileReader;x.readAsDataURL(l),x.onloadend=function(){const f=x.result;n.buffers[0].uri=f,s(n)}}else s(n)}serializeUserData(e,s){if(Object.keys(e.userData).length===0)return;const t=this.options,i=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(t.includeCustomExtensions&&r.gltfExtensions){s.extensions===void 0&&(s.extensions={});for(const n in r.gltfExtensions)s.extensions[n]=r.gltfExtensions[n],i[n]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(s.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,s=!1){if(this.uids.has(e)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(e,i)}return this.uids.get(e).get(s)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new k;for(let i=0,r=e.count;i<r;i++)if(Math.abs(t.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const s=this.cache;if(s.attributesNormalized.has(e))return s.attributesNormalized.get(e);const t=e.clone(),i=new k;for(let r=0,n=t.count;r<n;r++)i.fromBufferAttribute(t,r),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),t.setXYZ(r,i.x,i.y,i.z);return s.attributesNormalized.set(e,t),t}applyTextureTransform(e,s){let t=!1;const i={};(s.offset.x!==0||s.offset.y!==0)&&(i.offset=s.offset.toArray(),t=!0),s.rotation!==0&&(i.rotation=s.rotation,t=!0),(s.repeat.x!==1||s.repeat.y!==1)&&(i.scale=s.repeat.toArray(),t=!0),t&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,s){if(e===s)return e;function t(f){return f.colorSpace===Me?function(h){return h<.04045?h*.0773993808:Math.pow(h*.9478672986+.0521327014,2.4)}:function(h){return h}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof J&&(e=Q(e)),s instanceof J&&(s=Q(s));const i=e?e.image:null,r=s?s.image:null,n=Math.max(i?i.width:0,r?r.width:0),o=Math.max(i?i.height:0,r?r.height:0),c=me();c.width=n,c.height=o;const l=c.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,n,o);const d=l.getImageData(0,0,n,o);if(i){l.drawImage(i,0,0,n,o);const f=t(e),p=l.getImageData(0,0,n,o).data;for(let h=2;h<p.length;h+=4)d.data[h]=f(p[h]/256)*256}if(r){l.drawImage(r,0,0,n,o);const f=t(s),p=l.getImageData(0,0,n,o).data;for(let h=1;h<p.length;h+=4)d.data[h]=f(p[h]/256)*256}l.putImageData(d,0,0);const x=(e||s).clone();return x.source=new Ge(c),x.colorSpace=ke,x.channel=(e||s).channel,e&&s&&e.channel!==s.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),x}processBuffer(e){const s=this.json,t=this.buffers;return s.buffers||(s.buffers=[{byteLength:0}]),t.push(e),0}processBufferView(e,s,t,i,r){const n=this.json;n.bufferViews||(n.bufferViews=[]);let o;switch(s){case T.BYTE:case T.UNSIGNED_BYTE:o=1;break;case T.SHORT:case T.UNSIGNED_SHORT:o=2;break;default:o=4}let c=e.itemSize*o;r===T.ARRAY_BUFFER&&(c=Math.ceil(c/4)*4);const l=Ae(i*c),d=new DataView(new ArrayBuffer(l));let u=0;for(let p=t;p<t+i;p++){for(let h=0;h<e.itemSize;h++){let g;e.itemSize>4?g=e.array[p*e.itemSize+h]:(h===0?g=e.getX(p):h===1?g=e.getY(p):h===2?g=e.getZ(p):h===3&&(g=e.getW(p)),e.normalized===!0&&(g=ie.normalize(g,e.array))),s===T.FLOAT?d.setFloat32(u,g,!0):s===T.INT?d.setInt32(u,g,!0):s===T.UNSIGNED_INT?d.setUint32(u,g,!0):s===T.SHORT?d.setInt16(u,g,!0):s===T.UNSIGNED_SHORT?d.setUint16(u,g,!0):s===T.BYTE?d.setInt8(u,g):s===T.UNSIGNED_BYTE&&d.setUint8(u,g),u+=o}u%c!==0&&(u+=c-u%c)}const x={buffer:this.processBuffer(d.buffer),byteOffset:this.byteOffset,byteLength:l};return r!==void 0&&(x.target=r),r===T.ARRAY_BUFFER&&(x.byteStride=c),this.byteOffset+=l,n.bufferViews.push(x),{id:n.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const s=this,t=s.json;return t.bufferViews||(t.bufferViews=[]),new Promise(function(i){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const n=te(r.result),o={buffer:s.processBuffer(n),byteOffset:s.byteOffset,byteLength:n.byteLength};s.byteOffset+=n.byteLength,i(t.bufferViews.push(o)-1)}})}processAccessor(e,s,t,i){const r=this.json,n={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let o;if(e.array.constructor===Float32Array)o=T.FLOAT;else if(e.array.constructor===Int32Array)o=T.INT;else if(e.array.constructor===Uint32Array)o=T.UNSIGNED_INT;else if(e.array.constructor===Int16Array)o=T.SHORT;else if(e.array.constructor===Uint16Array)o=T.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)o=T.BYTE;else if(e.array.constructor===Uint8Array)o=T.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(t===void 0&&(t=0),(i===void 0||i===1/0)&&(i=e.count),i===0)return null;const c=pt(e,t,i);let l;s!==void 0&&(l=e===s.index?T.ELEMENT_ARRAY_BUFFER:T.ARRAY_BUFFER);const d=this.processBufferView(e,o,t,i,l),u={bufferView:d.id,byteOffset:d.byteOffset,componentType:o,count:i,max:c.max,min:c.min,type:n[e.itemSize]};return e.normalized===!0&&(u.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(u)-1}processImage(e,s,t,i="image/png"){if(e!==null){const r=this,n=r.cache,o=r.json,c=r.options,l=r.pending;n.images.has(e)||n.images.set(e,{});const d=n.images.get(e),u=i+":flipY/"+t.toString();if(d[u]!==void 0)return d[u];o.images||(o.images=[]);const x={mimeType:i},f=me();f.width=Math.min(e.width,c.maxTextureSize),f.height=Math.min(e.height,c.maxTextureSize);const p=f.getContext("2d");if(t===!0&&(p.translate(0,f.height),p.scale(1,-1)),e.data!==void 0){s!==He&&console.error("GLTFExporter: Only RGBAFormat is supported.",s),(e.width>c.maxTextureSize||e.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const g=new Uint8ClampedArray(e.height*e.width*4);for(let b=0;b<g.length;b+=4)g[b+0]=e.data[b+0],g[b+1]=e.data[b+1],g[b+2]=e.data[b+2],g[b+3]=e.data[b+3];p.putImageData(new ImageData(g,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)p.drawImage(e,0,0,f.width,f.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");c.binary===!0?l.push(Te(f,i).then(g=>r.processBufferViewImage(g)).then(g=>{x.bufferView=g})):f.toDataURL!==void 0?x.uri=f.toDataURL(i):l.push(Te(f,i).then(g=>new FileReader().readAsDataURL(g)).then(g=>{x.uri=g}));const h=o.images.push(x)-1;return d[u]=h,h}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const s=this.json;s.samplers||(s.samplers=[]);const t={magFilter:N[e.magFilter],minFilter:N[e.minFilter],wrapS:N[e.wrapS],wrapT:N[e.wrapT]};return s.samplers.push(t)-1}processTexture(e){const t=this.options,i=this.cache,r=this.json;if(i.textures.has(e))return i.textures.get(e);r.textures||(r.textures=[]),e instanceof J&&(e=Q(e,t.maxTextureSize));let n=e.userData.mimeType;n==="image/webp"&&(n="image/png");const o={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,n)};e.name&&(o.name=e.name),this._invokeAll(function(l){l.writeTexture&&l.writeTexture(e,o)});const c=r.textures.push(o)-1;return i.textures.set(e,c),c}processMaterial(e){const s=this.cache,t=this.json;if(s.materials.has(e))return s.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;t.materials||(t.materials=[]);const i={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);if(V(r,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const o=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),c={index:this.processTexture(o),channel:o.channel};this.applyTextureTransform(c,o),i.pbrMetallicRoughness.metallicRoughnessTexture=c}if(e.map){const o={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(o,e.map),i.pbrMetallicRoughness.baseColorTexture=o}if(e.emissive){const o=e.emissive;if(Math.max(o.r,o.g,o.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const l={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(l,e.emissiveMap),i.emissiveTexture=l}}if(e.normalMap){const o={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(o.scale=e.normalScale.x),this.applyTextureTransform(o,e.normalMap),i.normalTexture=o}if(e.aoMap){const o={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(o.strength=e.aoMapIntensity),this.applyTextureTransform(o,e.aoMap),i.occlusionTexture=o}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===Ee&&(i.doubleSided=!0),e.name!==""&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(o){o.writeMaterial&&o.writeMaterial(e,i)});const n=t.materials.push(i)-1;return s.materials.set(e,n),n}processMesh(e){const s=this.cache,t=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let m=0,y=e.material.length;m<y;m++)i.push(e.material[m].uuid);else i.push(e.material.uuid);const r=i.join(":");if(s.meshes.has(r))return s.meshes.get(r);const n=e.geometry;let o;e.isLineSegments?o=T.LINES:e.isLineLoop?o=T.LINE_LOOP:e.isLine?o=T.LINE_STRIP:e.isPoints?o=T.POINTS:o=e.material.wireframe?T.LINES:T.TRIANGLES;const c={},l={},d=[],u=[],x={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},f=n.getAttribute("normal");f!==void 0&&!this.isNormalizedNormalAttribute(f)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),n.setAttribute("normal",this.createNormalizedNormalAttribute(f)));let p=null;for(let m in n.attributes){if(m.slice(0,5)==="morph")continue;const y=n.attributes[m];if(m=x[m]||m.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(m)||(m="_"+m),s.attributes.has(this.getUID(y))){l[m]=s.attributes.get(this.getUID(y));continue}p=null;const I=y.array;m==="JOINTS_0"&&!(I instanceof Uint16Array)&&!(I instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new F(new Uint16Array(I),y.itemSize,y.normalized));const w=this.processAccessor(p||y,n);w!==null&&(m.startsWith("_")||this.detectMeshQuantization(m,y),l[m]=w,s.attributes.set(this.getUID(y),w))}if(f!==void 0&&n.setAttribute("normal",f),Object.keys(l).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const m=[],y=[],R={};if(e.morphTargetDictionary!==void 0)for(const I in e.morphTargetDictionary)R[e.morphTargetDictionary[I]]=I;for(let I=0;I<e.morphTargetInfluences.length;++I){const w={};let L=!1;for(const E in n.morphAttributes){if(E!=="position"&&E!=="normal"){L||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),L=!0);continue}const M=n.morphAttributes[E][I],z=E.toUpperCase(),_=n.attributes[E];if(s.attributes.has(this.getUID(M,!0))){w[z]=s.attributes.get(this.getUID(M,!0));continue}const v=M.clone();if(!n.morphTargetsRelative)for(let A=0,B=M.count;A<B;A++)for(let U=0;U<M.itemSize;U++)U===0&&v.setX(A,M.getX(A)-_.getX(A)),U===1&&v.setY(A,M.getY(A)-_.getY(A)),U===2&&v.setZ(A,M.getZ(A)-_.getZ(A)),U===3&&v.setW(A,M.getW(A)-_.getW(A));w[z]=this.processAccessor(v,n),s.attributes.set(this.getUID(_,!0),w[z])}u.push(w),m.push(e.morphTargetInfluences[I]),e.morphTargetDictionary!==void 0&&y.push(R[I])}c.weights=m,y.length>0&&(c.extras={},c.extras.targetNames=y)}const h=Array.isArray(e.material);if(h&&n.groups.length===0)return null;let g=!1;if(h&&n.index===null){const m=[];for(let y=0,R=n.attributes.position.count;y<R;y++)m[y]=y;n.setIndex(m),g=!0}const b=h?e.material:[e.material],S=h?n.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let m=0,y=S.length;m<y;m++){const R={mode:o,attributes:l};if(this.serializeUserData(n,R),u.length>0&&(R.targets=u),n.index!==null){let w=this.getUID(n.index);(S[m].start!==void 0||S[m].count!==void 0)&&(w+=":"+S[m].start+":"+S[m].count),s.attributes.has(w)?R.indices=s.attributes.get(w):(R.indices=this.processAccessor(n.index,n,S[m].start,S[m].count),s.attributes.set(w,R.indices)),R.indices===null&&delete R.indices}const I=this.processMaterial(b[S[m].materialIndex]);I!==null&&(R.material=I),d.push(R)}g===!0&&n.setIndex(null),c.primitives=d,t.meshes||(t.meshes=[]),this._invokeAll(function(m){m.writeMesh&&m.writeMesh(e,c)});const D=t.meshes.push(c)-1;return s.meshes.set(r,D),D}detectMeshQuantization(e,s){if(this.extensionsUsed[ee])return;let t;switch(s.array.constructor){case Int8Array:t="byte";break;case Uint8Array:t="unsigned byte";break;case Int16Array:t="short";break;case Uint16Array:t="unsigned short";break;default:return}s.normalized&&(t+=" normalized");const i=e.split("_",1)[0];de[i]&&de[i].includes(t)&&(this.extensionsUsed[ee]=!0,this.extensionsRequired[ee]=!0)}processCamera(e){const s=this.json;s.cameras||(s.cameras=[]);const t=e.isOrthographicCamera,i={type:t?"orthographic":"perspective"};return t?i.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:ie.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(i.name=e.type),s.cameras.push(i)-1}processAnimation(e,s){const t=this.json,i=this.nodeMap;t.animations||(t.animations=[]),e=oe.Utils.mergeMorphTargetTracks(e.clone(),s);const r=e.tracks,n=[],o=[];for(let c=0;c<r.length;++c){const l=r[c],d=$.parseTrackName(l.name);let u=$.findNode(s,d.nodeName);const x=pe[d.propertyName];if(d.objectName==="bones"&&(u.isSkinnedMesh===!0?u=u.skeleton.getBoneByName(d.objectIndex):u=void 0),!u||!x)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name),null;const f=1;let p=l.values.length/l.times.length;x===pe.morphTargetInfluences&&(p/=u.morphTargetInfluences.length);let h;l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(h="CUBICSPLINE",p/=3):l.getInterpolation()===Ve?h="STEP":h="LINEAR",o.push({input:this.processAccessor(new F(l.times,f)),output:this.processAccessor(new F(l.values,p)),interpolation:h}),n.push({sampler:o.length-1,target:{node:i.get(u),path:x}})}return t.animations.push({name:e.name||"clip_"+t.animations.length,samplers:o,channels:n}),t.animations.length-1}processSkin(e){const s=this.json,t=this.nodeMap,i=s.nodes[t.get(e)],r=e.skeleton;if(r===void 0)return null;const n=e.skeleton.bones[0];if(n===void 0)return null;const o=[],c=new Float32Array(r.bones.length*16),l=new Ie;for(let u=0;u<r.bones.length;++u)o.push(t.get(r.bones[u])),l.copy(r.boneInverses[u]),l.multiply(e.bindMatrix).toArray(c,u*16);return s.skins===void 0&&(s.skins=[]),s.skins.push({inverseBindMatrices:this.processAccessor(new F(c,16)),joints:o,skeleton:t.get(n)}),i.skin=s.skins.length-1}processNode(e){const s=this.json,t=this.options,i=this.nodeMap;s.nodes||(s.nodes=[]);const r={};if(t.trs){const o=e.quaternion.toArray(),c=e.position.toArray(),l=e.scale.toArray();V(o,[0,0,0,1])||(r.rotation=o),V(c,[0,0,0])||(r.translation=c),V(l,[1,1,1])||(r.scale=l)}else e.matrixAutoUpdate&&e.updateMatrix(),dt(e.matrix)===!1&&(r.matrix=e.matrix.elements);if(e.name!==""&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const o=this.processMesh(e);o!==null&&(r.mesh=o)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const o=[];for(let c=0,l=e.children.length;c<l;c++){const d=e.children[c];if(d.visible||t.onlyVisible===!1){const u=this.processNode(d);u!==null&&o.push(u)}}o.length>0&&(r.children=o)}this._invokeAll(function(o){o.writeNode&&o.writeNode(e,r)});const n=s.nodes.push(r)-1;return i.set(e,n),n}processScene(e){const s=this.json,t=this.options;s.scenes||(s.scenes=[],s.scene=0);const i={};e.name!==""&&(i.name=e.name),s.scenes.push(i);const r=[];for(let n=0,o=e.children.length;n<o;n++){const c=e.children[n];if(c.visible||t.onlyVisible===!1){const l=this.processNode(c);l!==null&&r.push(l)}}r.length>0&&(i.nodes=r),this.serializeUserData(e,i)}processObjects(e){const s=new X;s.name="AuxScene";for(let t=0;t<e.length;t++)s.children.push(e[t]);this.processScene(s)}processInput(e){const s=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(e)});const t=[];for(let i=0;i<e.length;i++)e[i]instanceof X?this.processScene(e[i]):t.push(e[i]);t.length>0&&this.processObjects(t);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<s.animations.length;++i)this.processAnimation(s.animations[i],e[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(e)})}_invokeAll(e){for(let s=0,t=this.plugins.length;s<t;s++)e(this.plugins[s])}}class xt{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,s){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const t=this.writer,i=t.json,r=t.extensionsUsed,n={};e.name&&(n.name=e.name),n.color=e.color.toArray(),n.intensity=e.intensity,e.isDirectionalLight?n.type="directional":e.isPointLight?(n.type="point",e.distance>0&&(n.range=e.distance)):e.isSpotLight&&(n.type="spot",e.distance>0&&(n.range=e.distance),n.spot={},n.spot.innerConeAngle=(1-e.penumbra)*e.angle,n.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},r[this.name]=!0);const o=i.extensions[this.name].lights;o.push(n),s.extensions=s.extensions||{},s.extensions[this.name]={light:o.length-1}}}class mt{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,s){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;s.extensions=s.extensions||{},s.extensions[this.name]={},i[this.name]=!0,s.pbrMetallicRoughness.metallicFactor=0,s.pbrMetallicRoughness.roughnessFactor=.9}}class Tt{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,s){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const t=this.writer,i=t.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const n={index:t.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};t.applyTextureTransform(n,e.clearcoatMap),r.clearcoatTexture=n}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const n={index:t.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};t.applyTextureTransform(n,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=n}if(e.clearcoatNormalMap){const n={index:t.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};e.clearcoatNormalScale.x!==1&&(n.scale=e.clearcoatNormalScale.x),t.applyTextureTransform(n,e.clearcoatNormalMap),r.clearcoatNormalTexture=n}s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class wt{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}writeMaterial(e,s){if(!e.isMeshPhysicalMaterial||e.dispersion===0)return;const i=this.writer.extensionsUsed,r={};r.dispersion=e.dispersion,s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class Mt{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,s){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const t=this.writer,i=t.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const n={index:t.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};t.applyTextureTransform(n,e.iridescenceMap),r.iridescenceTexture=n}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const n={index:t.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};t.applyTextureTransform(n,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=n}s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class yt{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,s){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const t=this.writer,i=t.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const n={index:t.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};t.applyTextureTransform(n,e.transmissionMap),r.transmissionTexture=n}s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class Et{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,s){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const t=this.writer,i=t.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const n={index:t.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};t.applyTextureTransform(n,e.thicknessMap),r.thicknessTexture=n}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class It{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,s){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const i=this.writer.extensionsUsed,r={};r.ior=e.ior,s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class At{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,s){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(at)&&!e.specularIntensityMap&&!e.specularColorMap)return;const t=this.writer,i=t.extensionsUsed,r={};if(e.specularIntensityMap){const n={index:t.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};t.applyTextureTransform(n,e.specularIntensityMap),r.specularTexture=n}if(e.specularColorMap){const n={index:t.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};t.applyTextureTransform(n,e.specularColorMap),r.specularColorTexture=n}r.specularFactor=e.specularIntensity,r.specularColorFactor=e.specularColor.toArray(),s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class bt{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,s){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const t=this.writer,i=t.extensionsUsed,r={};if(e.sheenRoughnessMap){const n={index:t.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};t.applyTextureTransform(n,e.sheenRoughnessMap),r.sheenRoughnessTexture=n}if(e.sheenColorMap){const n={index:t.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};t.applyTextureTransform(n,e.sheenColorMap),r.sheenColorTexture=n}r.sheenRoughnessFactor=e.sheenRoughness,r.sheenColorFactor=e.sheenColor.toArray(),s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class Rt{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,s){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const t=this.writer,i=t.extensionsUsed,r={};if(e.anisotropyMap){const n={index:t.processTexture(e.anisotropyMap)};t.applyTextureTransform(n,e.anisotropyMap),r.anisotropyTexture=n}r.anisotropyStrength=e.anisotropy,r.anisotropyRotation=e.anisotropyRotation,s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class Lt{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,s){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const i=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class St{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,s){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const t=this.writer,i=t.extensionsUsed,r={};if(e.bumpMap){const n={index:t.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};t.applyTextureTransform(n,e.bumpMap),r.bumpTexture=n}r.bumpFactor=e.bumpScale,s.extensions=s.extensions||{},s.extensions[this.name]=r,i[this.name]=!0}}class Nt{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,s){if(!e.isInstancedMesh)return;const t=this.writer,i=e,r=new Float32Array(i.count*3),n=new Float32Array(i.count*4),o=new Float32Array(i.count*3),c=new Ie,l=new k,d=new et,u=new k;for(let f=0;f<i.count;f++)i.getMatrixAt(f,c),c.decompose(l,d,u),l.toArray(r,f*3),d.toArray(n,f*4),u.toArray(o,f*3);const x={TRANSLATION:t.processAccessor(new F(r,3)),ROTATION:t.processAccessor(new F(n,4)),SCALE:t.processAccessor(new F(o,3))};i.instanceColor&&(x._COLOR_0=t.processAccessor(i.instanceColor)),s.extensions=s.extensions||{},s.extensions[this.name]={attributes:x},t.extensionsUsed[this.name]=!0,t.extensionsRequired[this.name]=!0}}oe.Utils={insertKeyframe:function(a,e){const t=a.getValueSize(),i=new a.TimeBufferType(a.times.length+1),r=new a.ValueBufferType(a.values.length+t),n=a.createInterpolant(new a.ValueBufferType(t));let o;if(a.times.length===0){i[0]=e;for(let c=0;c<t;c++)r[c]=0;o=0}else if(e<a.times[0]){if(Math.abs(a.times[0]-e)<.001)return 0;i[0]=e,i.set(a.times,1),r.set(n.evaluate(e),0),r.set(a.values,t),o=0}else if(e>a.times[a.times.length-1]){if(Math.abs(a.times[a.times.length-1]-e)<.001)return a.times.length-1;i[i.length-1]=e,i.set(a.times,0),r.set(a.values,0),r.set(n.evaluate(e),a.values.length),o=i.length-1}else for(let c=0;c<a.times.length;c++){if(Math.abs(a.times[c]-e)<.001)return c;if(a.times[c]<e&&a.times[c+1]>e){i.set(a.times.slice(0,c+1),0),i[c+1]=e,i.set(a.times.slice(c+1),c+2),r.set(a.values.slice(0,(c+1)*t),0),r.set(n.evaluate(e),(c+1)*t),r.set(a.values.slice((c+1)*t),(c+2)*t),o=c+1;break}}return a.times=i,a.values=r,o},mergeMorphTargetTracks:function(a,e){const s=[],t={},i=a.tracks;for(let r=0;r<i.length;++r){let n=i[r];const o=$.parseTrackName(n.name),c=$.findNode(e,o.nodeName);if(o.propertyName!=="morphTargetInfluences"||o.propertyIndex===void 0){s.push(n);continue}if(n.createInterpolant!==n.InterpolantFactoryMethodDiscrete&&n.createInterpolant!==n.InterpolantFactoryMethodLinear){if(n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),n=n.clone(),n.setInterpolation(Ye)}const l=c.morphTargetInfluences.length,d=c.morphTargetDictionary[o.propertyIndex];if(d===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let u;if(t[c.uuid]===void 0){u=n.clone();const f=new u.ValueBufferType(l*u.times.length);for(let p=0;p<u.times.length;p++)f[p*l+d]=u.values[p];u.name=(o.nodeName||"")+".morphTargetInfluences",u.values=f,t[c.uuid]=u,s.push(u);continue}const x=n.createInterpolant(new n.ValueBufferType(1));u=t[c.uuid];for(let f=0;f<u.times.length;f++)u.values[f*l+d]=x.evaluate(u.times[f]);for(let f=0;f<n.times.length;f++){const p=this.insertKeyframe(u,n.times[f]);u.values[p*l+d]=n.values[f]}}return a.tracks=s,a}};class _t{constructor(e){this.domLogger=e}optimize(e){if(e){if(!e.isMesh||!e.geometry)throw new Error("The model provided is not of type Mesh or does not have a geometry. Make you sure you assign a three.js mesh object (not a group).")}else throw new Error("You should pass a mesh to be optimized! There was nothing provided.");const s=this.getMaxSize(e);for(let t=1;t<=3;t++){const i=this.mergeByDistance(e,Math.pow(s,2),t);this.log(`Output pass ${t} vertices: ${i.geometry.attributes.position.count}`),this.download(i,t)}}mergeByDistance(e,s,t){const i=(n,o)=>{o=Math.max(o,Number.EPSILON);const c={},l=n.getIndex(),d=n.getAttribute("position"),u=l?l.count:d.count;let x=0;const f=Object.keys(n.attributes),p={},h={},g=[],b=["getX","getY","getZ","getW"],S=["setX","setY","setZ","setW"];for(let w=0;w<f.length;w++){const L=f[w],E=n.attributes[L];p[L]=new F(new E.array.constructor(E.count*E.itemSize),E.itemSize,E.normalized);const M=n.morphAttributes[L];M&&(h[L]=new BufferAttribute(new M.array.constructor(M.count*M.itemSize),M.itemSize,M.normalized))}const D=o*.5,m=Math.log10(1/o),y=Math.pow(10,m),R=D*y;for(let w=0;w<u;w++){const L=l?l.getX(w):w;let E="";for(let M=0,z=f.length;M<z;M++){const _=f[M],v=n.getAttribute(_),A=v.itemSize;for(let B=0;B<A;B++)E+=`${~~(v[b[B]](L)*y+R)},`}if(E in c)g.push(c[E]);else{for(let M=0,z=f.length;M<z;M++){const _=f[M],v=n.getAttribute(_),A=n.morphAttributes[_],B=v.itemSize,U=p[_],_e=h[_];for(let Y=0;Y<B;Y++){const le=b[Y],ue=S[Y];if(U[ue](x,v[le](L)),A)for(let K=0,ve=A.length;K<ve;K++)_e[K][ue](x,A[K][le](L))}}c[E]=x,g.push(x),x++}}const I=n.clone();for(const w in n.attributes){const L=p[w];if(I.setAttribute(w,new F(L.array.slice(0,x*L.itemSize),L.itemSize,L.normalized)),w in h)for(let E=0;E<h[w].length;E++){const M=h[w][E];I.morphAttributes[w][E]=new F(M.array.slice(0,x*M.itemSize),M.itemSize,M.normalized)}}return I.setIndex(g),I};let r=s*1e-6;return t===2?r=s*7e-6:t===3&&(r=s*15e-6),e.geometry=i(e.geometry,r),console.log(e.geometry.attributes.position.count),e}getMaxSize(e){const s=new tt().setFromObject(e),t=new k;return s.getSize(t),Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))}updateLoadedFile(e){this.loadedFile=e}download(e,s){const t=document.createElement("a");t.style.display="none",document.body.appendChild(t);const i=(n,o)=>{const c=new Blob([n],{type:"application/octet-stream"});this.log(`Output pass ${s} size: ~${Math.round(Number(c.size/1024)).toLocaleString()}KB`),t.href=URL.createObjectURL(c),t.download=o,t.click()},r=new oe;if(this.loadedFile){const n=this.loadedFile.name,o=n.toLowerCase().slice(n.lastIndexOf(".")+1,n.length),c=`pass${s}-${n.replace(o,"glb")}`;r.parse(e,l=>{i(l,c)},l=>{throw new Error(l)},{binary:!0})}else console.log("load a file first!")}log(e,s=!1){s&&(this.domLogger.innerHTML=""),this.domLogger.innerHTML+=`<li>${e}</li>`}}const vt=document.getElementById("log"),C=new _t(vt);let re=0;const ae=document.getElementById("content");let O=null;ae.addEventListener("dragenter",a=>{a.stopPropagation(),a.preventDefault()});ae.addEventListener("dragover",a=>{a.stopPropagation(),a.preventDefault()});ae.addEventListener("drop",a=>{a.stopPropagation(),a.preventDefault(),Ct(a)});function Ct(a){O=a.dataTransfer.files[0],Re(0)}document.getElementById("uploadform").addEventListener("change",()=>{O=document.getElementById("uploadform").files[0],Re(0)});function we(a){a?re=Date.now():re-=Date.now()}let be,se;new k;let G,ne;const q=[],W=new st({side:Ee});function Re(a){const e={obj:new nt,stl:new it,glb:new fe,gltf:new fe,fbx:new rt,ply:new ot,usdz:new he,usdc:new he},s=(t,i)=>{t==="obj"||t==="stl"||t==="glb"||t==="gltf"||t==="fbx"||t==="usdz"||t==="usdc"||t==="ply"?e[t].load(i,r=>{q[a].clear(),t==="obj"?(r.traverse(n=>{n.material=W}),G=r):t==="stl"||t==="ply"?G=new ye(r,W):t==="glb"||t==="gltf"?(r.scene.traverse(n=>{n.material=W}),G=r.scene):t==="fbx"?(r.traverse(n=>{n.material=W}),console.error("FBX files are not well supported, yet"),C.log("FBX files are not well supported, yet"),G=r):(t==="usdc"||t==="usdz")&&(console.log(r),G=r),ne=G.clone(),se=0,ne.traverse(n=>{n.isMesh&&(se+=n.geometry.attributes.position.count,C.log(`Input vertices: ${se}`)),n.isMesh&&C.optimize(n)}),we(!1),C.log(`Finished in ${Math.abs(Number(re)).toLocaleString()}ms. Please, reload the page if you want to upload the same file again.`),q[a].add(ne)}):(console.log(`Wrong or unsupported file format. File type: ${t}`),C.log(`Wrong or unsupported file format. File type: .${t} Please, upload .obj .slt or .glb files.`))};if(a===0&&O){C.updateLoadedFile(O),C.log("Loading model...",!0),C.log(`Input file name: ${O.name}`),C.log(`Input file size: ~${Math.round(Number(O.size/1024)).toLocaleString()}KB`),C.log("Getting files ready to be downloaded..."),C.log("---------Please--Wait----------"),we(!0);const t=O.name,i=t.toLowerCase().slice(t.lastIndexOf(".")+1,t.length),r=new FileReader;r.addEventListener("load",function(n){const o=n.target.result;s(i,o)}),r.readAsDataURL(O)}}be=document.getElementById("c");const Ft=document.getElementById("content"),Le=new X,ce=document.createElement("div");ce.className="list-item";const Se=document.createElement("div");ce.appendChild(Se);Le.userData.element=Se;Ft.appendChild(ce);q.push(Le);function Ne(){Ut(),requestAnimationFrame(Ne)}Ne();function Ut(){be.style.transform=`translateY(${window.scrollY}px)`,q.forEach(function(a){a.userData.element.getBoundingClientRect()})}
